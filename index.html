<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AndresRCA</title>
	<link rel="icon" type="image/x-icon" href="favicon.ico">
	<!-- bootstrap v3.3.4 -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<!-- font-awesome -->
	<script src="https://kit.fontawesome.com/1c24a8e905.js" crossorigin="anonymous"></script>
	<!-- google font -->
	<link href='http://fonts.googleapis.com/css?family=Raleway:400,300,700,800' rel='stylesheet' type='text/css'>
	<!-- docSlider -->
	<link rel="stylesheet" href="css/docSlider.css">
	<!-- animate.css -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" integrity="sha512-c42qTSw/wPZ3/5LBzD+Bw5f7bSF2oxou6wEb+I/lqeaKV5FDIfMvvRp772y4jcJLKuGUOpbJMdg/BTl50fJYAw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<!-- hightlight.js -->
	<!-- <link rel="stylesheet" href="css/vs2015.min.css">
	<script src="js/highlight.min.js"></script> -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
	<!-- custom -->
	<link rel="stylesheet" href="css/styles.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.3.0/github-markdown-dark.min.css" integrity="sha512-Cucyy1VsVrQdCoemlbCfzHU5k4KWnBRwc8ozzmHNcl7MGTOwxKPJOnkSqECyfhSggXT0Fn4bpqWZp3Dk5O7Cgw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<style>
		.markdown-body {
			font-weight: 100;
			box-sizing: border-box;
			min-width: 200px;
			max-width: 980px;
			margin: 0 auto;
			padding: 45px;
		}
	
		@media (max-width: 767px) {
			.markdown-body {
				padding: 15px;
			}
		}
	</style>
</head>

<body>
	<div class="docSlider">

		<!-- start home -->
		<section id="home">
			<div class="container">
				<div class="row">
					<div class="col-md-2"></div>
					<div class="col-md-8 animate invisible" data-animation="fadeIn" data-animation-delay="0.9s" data-animation-duration="1.4s">
						<h3>Lorem ipsum</h3>
						<h1 class="animate invisible" data-animation="fadeIn" data-animation-delay="1.5s" data-animation-duration="1.8s">Andr√©s R. Castillo Aguilar</h1>
						<h2 class="rotate">TELECOMUNNICATIONS ENGINEER, FULLSTACK DEVELOPER, PROFESSIONAL</h2>
						<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut
							laoreet. Dolore magna aliquam erat volutpat.</p>
						<a href="#work" class="btn btn-default animate invisible" data-animation="fadeInUp" data-animation-delay="1s">What I do</a>
					</div>
					<div class="col-md-2"></div>
				</div>
			</div>
		</section>
		<!-- end home -->

		<!-- start work -->
		<section id="work" class="custom-scrollbar">
			<div class="container">
				<div class="row">
					<div class="col-md-12 animate" data-animation="bounce">
						<h2>WHAT I DO</h2>
					</div>
				</div>

				<div class="row">
					<div class="col-md-4 col-xs-11">
						<div class="media animate invisible" data-animation="fadeInUp" data-animation-delay="0.6s">
							<div class="media-object media-left">
								<i class="fa fa-cog"></i>
							</div>
							<div class="media-body">
								<h3 class="media-heading">Maintainable Platforms</h3>
								<p>When working with a team I always pay attention to how things are already built, if I notice development standards being used I will set aside my personal way of doing things (if they happen to be different) and happily develop knowing that doing so will help maintain consistency in the codebase, making things easier to read and to find.</p>
								<p>Having said that, I would not blindly replicate what I would objectively recognize to be a bad practice. Instead I would help steer the project in a positive direction by respectfully pointing out potential issues and the justification for it.</p>
							</div>
						</div>
					</div>

					<div class="col-md-4 col-xs-11">
						<div class="media animate invisible" data-animation="fadeInUp" data-animation-delay="0.6s">
							<div class="media-object media-left">
								<i class="fa fa-bug"></i>
							</div>
							<div class="media-body">
								<h3 class="media-heading">Tests and Stability</h3>
								<p>In my development process, I place great emphasis on ensuring that my code is stable, reliable, and of course understandable for anyone that has to work in the same codebase. To achieve this, I personally would like to be part of a team that adheres to a test-driven development approach. However, I understand that the requirements of a project can change, and so it's important to communicate effectively to avoid spending time on unnecessary tests that may need to be rewritten. Fundamentally if an idea is conveyed correctly there should be no need to rewrite code that expects a different behaviour. <!-- I prioritize stability by using Github issues to track bugs and features, and branches and pull requests for code changes. --></p>
							</div>
						</div>
					</div>

					<div class="col-md-4 col-xs-11">
						<div class="media animate invisible" data-animation="fadeInUp" data-animation-delay="0.6s">
							<div class="media-object media-left">
								<i class="fa fa-hands-helping"></i>
							</div>
							<div class="media-body">
								<h3 class="media-heading">Collaborative and patient</h3>
								<p>I approach working with colleagues who may be resistant to feedback or collaboration with patience and persistence, seeking to build trust over time by finding common ground. Of course communication is something that requires the collaboration of the parties involved, so it's not like there's always a guarantee of things going well all the time, but from the get-go I make sure to establish that it's ok to be open and frank with me, and that my position will always be transparency when communicating.<a rel="nofollow" href="https://pixabay.com">Pixabay</a></p>
							</div>
						</div>
					</div>

				</div>
			</div>
		</section>
		<!-- end work -->

		<!-- start about -->
		<section id="about">
			<div class="container">
				<div class="row">
					<div class="col-md-6 col-xs-11 animate invisible" data-animation="fadeInLeft" data-animation-delay="0.2s">
						<h2>ABOUT ME</h2>
						<h4>CAUTIOUS &AMP; CRITICAL THINKER</h4>
						<p>I consider myself to be a highly adaptable and fast learner in general, with a strong passion for self-improvement and utilizing modern tools that make daily life easier. I always strive to pay exceptional attention to detail and am eager to tackle any problem. I believe that through thorough planning and utilizing a diverse set of skills and knowledge, success can be achieved in any field.</p>
						<p>The following is a list of some hard and soft skills and my affinity to them. Things such as interest in the field, confidence and practical experience are taken into account for defining my score in them, so do take it with a grain of salt. For more details make sure to check my CV.</p>
					</div>
					<div class="col-md-6 col-xs-11">
						<div class="animate invisible" data-animation="fadeInUp" data-animation-delay="0.8s" data-animation-duration="0.5s">
							<span class="text-top">Backend Development <small>96%</small></span>
							<div class="progress">
								<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="96" aria-valuemin="0"
									aria-valuemax="100" style="width: 96%;"></div>
							</div>
						</div>
						<div class="animate invisible" data-animation="fadeInUp" data-animation-delay="1s" data-animation-duration="0.5s">
							<span>Frontend Development (Angular, Vue, React) <small>93%</small></span>
							<div class="progress">
								<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="93" aria-valuemin="0"
									aria-valuemax="100" style="width: 93%;"></div>
							</div>
						</div>
						<div class="animate invisible" data-animation="fadeInUp" data-animation-delay="1.2s" data-animation-duration="0.5s">
							<span>Arquitecture design <small>84%</small></span>
							<div class="progress">
								<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="84" aria-valuemin="0"
									aria-valuemax="100" style="width: 84%;"></div>
							</div>
						</div>
						<div class="animate invisible" data-animation="fadeInUp" data-animation-delay="1.4s" data-animation-duration="0.5s">
							<span>Databases <small>80%</small></span>
							<div class="progress">
								<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0"
									aria-valuemax="100" style="width: 80%;"></div>
							</div>
						</div>
						<div class="animate invisible" data-animation="fadeInUp" data-animation-delay="1.6s" data-animation-duration="0.5s">
							<span>Mobile Apps <small>75%</small></span>
							<div class="progress">
								<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="75" aria-valuemin="0"
									aria-valuemax="100" style="width: 75%;"></div>
							</div>
						</div>
						<div class="animate invisible" data-animation="fadeInUp" data-animation-delay="1.8s" data-animation-duration="0.5s">
							<span>Automatization <small>88%</small></span>
							<div class="progress">
								<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="88" aria-valuemin="0"
									aria-valuemax="100" style="width: 88%;"></div>
							</div>
						</div>
						<div class="animate invisible" data-animation="fadeInUp" data-animation-delay="2s" data-animation-duration="0.5s">
							<span>Careful Planning <small>98%</small></span>
							<div class="progress">
								<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="98" aria-valuemin="0"
									aria-valuemax="100" style="width: 98%;"></div>
							</div>
						</div>
						<div class="animate invisible" data-animation="fadeInUp" data-animation-delay="2.2s" data-animation-duration="0.5s">
							<span>Documenting and Development Policies Enjoyer <small>100%</small></span>
							<div class="progress">
								<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="100" aria-valuemin="0"
									aria-valuemax="100" style="width: 100%;"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- end about -->

		<!-- start snippets -->
		<section id="snippets">
			<div class="container-fluid">
				<div class="row">
					<div class="col-md-12 bounce">
						<h2>CODE SNIPPETS</h2>
					</div>
				</div>

				<!-- Model for a form control -->
				<div class="row">
					<div class="col-md-12">
						<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
							<div class="panel panel-custom">
								<div class="panel-heading" role="tab" id="exampleOne">
									<h4 class="panel-title">
										<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseExampleOne" aria-expanded="false" aria-controls="collapseOne">
											Model for a form control
										</a>
									</h4>
								</div>
								<div id="collapseExampleOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="exampleOne">
									<div class="panel-body">
										<pre><code class="language-typescript">
// IFormControl.interface.ts
export interface IFormControl {
  id: number;
  description: string | null;
  /**
   * order for the control (1 would mean it's the first element in the form)
   */
  order: number;
  styleRules?: IStyleRules;
  control: IControl;
  /**
   * name of function called in the backend used to retrieve the data for the control object
   */
  dataSource: string | null;
}

// IControl.interface.ts
export interface IControl&lt;T = any&gt; {
  name: string;
  tag?: 'input' | 'select' | 'textarea' | 'button';
  label?: string;
  /**
   * the text to show inside a button when tag is 'button'
   */
  content?: string;
  attributes?: {
    type?: 'text' | 'radio' | 'checkbox' | 'number' | 'tel' | 'date' | 'email' | 'url' | 'search' | 'password';
    placeholder?: string;
    /**
     * regex pattern as a string
     */
    pattern?: '[0-9]*' | '[0-9]{3}-[0-9]{7}';
    required?: true;
    disabled?: true;
    /**
     * the default value to place in a control, for example an input that's already filled out
     */
    value?: string | number | boolean | Object;
    minLength?: number;
    maxLength?: number;
    min?: number;
    max?: number;
  },
  /**
   * refers to these validators: https://angular.io/api/forms/Validators#validators
   */
  validators?: Array&lt;'required' | 'requiredTrue' | 'minLength' | 'maxLength' | 'min' | 'max' | 'pattern' | 'email' | 'nullValidator' | 'compose' | 'composeAsync'&gt;;
  /**
   * data to fill the form control
   */
  data?: Array&lt;T&gt;;
  /**
   * method to execute (in the case of a button)
   */
  action?: string;
  /**
   * must be the name of a form control (this is for external controls that execute actions and fill another control)
   */
  fills?: string;
  /**
   * the name of the group the control belongs to.
   */
  group?: string;
  /**
   * button that appears to the right side of the control
   */
  buttonGroup?: 'add' | 'search';
  /**
   * button that appears to the left side of the control, usually used to specify units (like USD, BS, etc)
   */
  buttonLabel?: {
    icon?: string;
    content?: string;
  }
}</code></pre>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Model for a form control -->
				<div class="row">
					<div class="col-md-12">
						<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
							<div class="panel panel-custom">
								<div class="panel-heading" role="tab" id="exampleTwo">
									<h4 class="panel-title">
										<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseExampleTwo" aria-expanded="false" aria-controls="collapseOne">
											Model for a form control
										</a>
									</h4>
								</div>
								<div id="collapseExampleTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="exampleTwo">
									<div class="panel-body">
<pre><code class="language-typescript">import { Component, Input, OnInit } from '@angular/core';
import { FormBuilder, FormControl, FormGroup, ValidatorFn, Validators } from '@angular/forms';
import { IControl } from './interfaces/IControl.interface';
import { IJsonForm } from './interfaces/IJsonForm.interface';
import { IJsonFormGroup } from './interfaces/IJsonFormGroup.interface';
import { FormInteractionService } from 'src/app/core/services/form-interaction.service';

/**
 * This component creates a form in a certain format, all it needs is a IJsonForm object.
 */
@Component({
  selector: 'app-json-form',
  templateUrl: './json-form.component.html',
  styleUrls: ['./json-form.component.scss']
})
export class JsonFormComponent implements OnInit {
  /**
   * Form coming from the backend
   */
  @Input() jsonForm!: IJsonForm;

  /**
   * Angular reactive form
   */
  public form!: FormGroup;
  /**
   * When the user wants to clear the form, this object stores the initial values
   */
  public formInitialValues: any;

  constructor(
    private fb: FormBuilder,
    private formInteractionService: FormInteractionService
  ) { }

  /**
   * Initialize form groups from the given jsonForm format
   */
  ngOnInit(): void {
    let formGroups: any = {}
    for (let formGroup of this.jsonForm.formGroups) {
      formGroups[formGroup.name!] = this.generateFormGroup(formGroup.formControls);
    }
    this.form = this.fb.group(formGroups);
    this.formInitialValues = this.form.value;
    // store the component so we can access its info on other components or services
    this.formInteractionService.formComponents.push(this);
  }

  /**
   *
   * @param name name used to identify the form group
   * @returns
   */
  public getFormGroup(name: string): FormGroup {
    return this.form.get(name) as FormGroup;
  }

  /**
    * Generate and return a form group (or form array) given the controls defined by the json format
    * @param jsonFormControls controls declared in json format
    * @returns newly generated FormGroup
    */
  private generateFormGroup(jsonFormControls: IJsonFormGroup['formControls']): FormGroup {
    let group: any = {};
    for (let formControl of jsonFormControls) {
      group[formControl.control.name] = this.generateControl(formControl.control);
    }
    return this.fb.group(group);
  }

  /**
    * Generate and return a form control using an IControl
    * @param control
    * @returns newly generated FormControl
    */
  private generateControl(control: IControl): FormControl {
    // create a control
    let customValidators = this.generateValidators(control.validators, control.attributes);
    let newControl = new FormControl(control.attributes?.value || null, customValidators);
    // add attributes to control
    if (control.attributes?.disabled) newControl.disable();
    return newControl;
  }

  /**
    * Generate an array of Validators
    * @param validatorNames
    * @returns empty array if validatorNames doesn't exist, otherwise an array of Validators
    */
  private generateValidators(validatorNames: IControl['validators'] = [], attributes: IControl['attributes']): ValidatorFn[] {
    return validatorNames.map((validatorName) => {
      switch (validatorName) {
        case 'minLength':
          return Validators.minLength(attributes!.minLength!);
        case 'maxLength':
          return Validators.maxLength(attributes!.maxLength!);
        case 'min':
          return Validators.min(attributes!.min!);
        case 'max':
          return Validators.max(attributes!.max!);
        case 'pattern':
          return Validators.pattern(attributes!.pattern!);
        default:
          // for validators that don't have an argument, just using the validatorName as a key is fine
          return Validators[validatorName]
      }
    }) as ValidatorFn[];
  }
}</code></pre>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- README.md for a SPA -->
				<div class="row">
					<div class="col-md-12">
						<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
							<div class="panel panel-custom">
								<div class="panel-heading" role="tab" id="exampleThree">
									<h4 class="panel-title">
										<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseExampleThree" aria-expanded="false" aria-controls="collapseOne">
											README.md file for a SPA
										</a>
									</h4>
								</div>
								<div id="collapseExampleThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="exampleThree">
									<div class="panel-body">
										<article class="markdown-body">
											<h1>Frontend</h1>
										
											<p>This SPA dashboard project was generated with <a href="https://github.com/angular/angular-cli">Angular CLI</a>
												version 15.2.1.</p>
										
											<h2>Development policies (<b>IMPORTANT TO FOLLOW</b>)</h2>
											<ul>
												<li>File placement: Placement of files that serve a certain function should be placed in accordance with the <a
														href="#folder-structure">Folder structure</a> explanation on folders.</li>
												<li>File naming (and other types of naming): This project generally follows the rules proposed by angular themselves
													<a href="https://angular.io/guide/styleguide#naming">here</a>, so <b>please</b> do give the guidelines a glance,
													there's reasons for why following a convention and keeping consistency does great work for the team, a few reasons
													described in the aforementioned document go like this:
													<ul>
														<li><strong>Naming conventions help provide a consistent way to find content at a glance. Consistency within the
																project is vital. Consistency with a team is important. Consistency across a company provides tremendous
																efficiency.</strong></li>
														<li><strong>The naming conventions should help find desired code faster and make it easier to
																understand.</strong></li>
													</ul>
												</li>
												<li>A notable rule that is often ignored would be <a
														href="https://angular.io/guide/styleguide#separate-file-names-with-dots-and-dashes">Separate file names with
														dots and dashes</a>. So <b>please</b> let's maintain consistency and keep our codebase healthy. Having said that
													there may be some room for exceptions or particular cases where I'd have deem worth doing differently, one example
													and hopefully the only one is the creation of <b>interfaces</b>, an interface file would usually be created as
													`user.interface.ts`, however for interfaces I prefer to add the prefix "I" before the name of the entity/model to
													easily identify in code what is an `Interface` and what is a `Class`, and name the files the same as the
													interface, resulting in `IUser.interface.ts` rather than `i-user.interface.ts` or `user.interface.ts`. This might
													be unnecessary but the result goes in line with the "<strong>The naming conventions should help find desired code
														faster and make it easier to understand.</strong>" point that was brought up.</li>
												<li>Naming convention for code: camelCase.</li>
												<li>The use of <strong>Route Guards</strong> and <strong>Resolvers</strong> is a must if a route contains any sort
													of data that is either fetched or passed on by some mean, such as a query url parameter, regular parameter, or
													from an API.</li>
												<li><strong>Route Guards</strong> and <strong>Resolvers</strong> should be contained in their own scope, for example
													a <strong>Guard</strong> that is used globally in different components should be defined in
													<code>src/app/guards/</code>, while the ones that are used exclusively by a component should be defined within
													their own directory, let's say <code>src/app/components/card-viewer/</code> as an example.</li>
												<li>The last point does not only apply to <strong>Guards</strong> and <strong>Resolvers</strong>, interfaces,
													services, and such other files should follow the same rule.</li>
												<li>Pull requests are encouraged, and quality checking is a must. A codebase is a thing that extends as time goes
													on, let's keep it healthy.</li>
											</ul>
										
											<h2>Key dependencies (prone to change or more likely to break your project)</h2>
											<h3>NPM dependencies</h3>
											<ul>
												<li>jQuery v2.1.4.</li>
												<li>bootstrap.bundle.js v4.0.0 (IMPORTANT: bootstrap.css is v4.0.0-beta and it is defined inside shamcey.css!!!).
												</li>
											</ul>
										
											<h3>Local dependencies <code>assets/lib</code></h3>
											<ul>
												<li>ionicons v2.0.0 (css and fonts).</li>
												<li>shamcey.css (contains bootstrap.css v4.0.0-beta and custom template style rules).</li>
											</ul>
										
											<h2>NPM scripts</h2>
<pre><code class="language-bash"># run in development mode
$ npm run start

# run in production mode
$ npm run start:prod

# build (The build artifacts will be stored in dist/)
$ npm run build

# build as you develop
$ npm run watch

# test execute the unit tests via Karma
$ npm run test</code></pre>
											<h2>Project's layout</h2>
											<img src="images/adminISP.png" alt="AdminISP">
										
											<p>Let's explain in detail what we're seeing here, first of all we have our root App, this App has a routing module
												from which you get routes like <code>/error</code>, <code>/signup</code>, <code>/signin</code> and finally
												<code>/dashboard</code> which is a path in our <code>app-routing.module</code> that has children routes, under this
												route we encounter our layout components that makes up our view, the important ones are <code>side-menu</code> and
												<code>page-body</code>.</p>
										
											<ul>
												<li><code>side-menu</code>: Holds the router links for our dashboard modules or user modules, these modules, such as
													registering a new user to our service, search for users and payment methods, and so forth.</li>
												<li><code>pagebody</code>: Container that holds our <code>&lt;router-outlet&gt;</code> for our
													<code>dashboard.module</code>, it's the place where we show the content of our modules, and these modules contain
													something I call "content blocks", these content blocks ideally should be a dynamic component that returns the
													component that matches the type of content block the module defines.</li>
											</ul>
											<p><code>ContentBlockComponent</code> doesn't exist but it is used as a placeholder name for components that should
												take the place as content, for example a <code>JsonFormComponent</code>, <code>ActionButtonsComponent</code>,
												<code>FilterFormComponent</code>, etc.</p>
										
											<h3>Folder structure</h3>
<pre><code class="language-bash">AdminISP
‚îú‚îÄ‚îÄ docs
‚îî‚îÄ‚îÄ src
    ‚îú‚îÄ‚îÄ abstract-classes
    ‚îú‚îÄ‚îÄ app
    ‚îÇ   ‚îú‚îÄ‚îÄ core
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services
    ‚îÇ   ‚îú‚îÄ‚îÄ guards
    ‚îÇ   ‚îú‚îÄ‚îÄ pages
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ breadcrumb
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ footer
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ headpanel
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ mainpanel
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pagebody
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pagetitle
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ side-menu
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ error
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signin
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ signup
    ‚îÇ   ‚îú‚îÄ‚îÄ services
    ‚îÇ   ‚îî‚îÄ‚îÄ shared
    ‚îú‚îÄ‚îÄ assets
    ‚îÇ   ‚îú‚îÄ‚îÄ css
    ‚îÇ   ‚îú‚îÄ‚îÄ img
    ‚îÇ   ‚îî‚îÄ‚îÄ lib
    ‚îú‚îÄ‚îÄ utils
    ‚îú‚îÄ‚îÄ mock-data
    ‚îú‚îÄ‚îÄ environments
    ‚îî‚îÄ‚îÄ shared-interfaces</code></pre>
											<p>This folder structure may or may not be outdated. For accuracy please do check the current project's folders on
												this repository.</p>
											<ul>
												<li><code>abstract-classes</code>: Folder where we define abstract classes that should help enforce business logic
													and policies/rules within components.</li>
												<li><code>app/pages</code>: As the name suggests it holds the pages for our <code>app-routing.module</code> routes,
													inside of it we have our <code>dashboard</code> folder that in itself also has its own routing module.</li>
												<li><code>dashboard/components</code>: There should be no need for an explanation but this is where we store our
													components used within the dashboard, and most importantly, the <code>ModuleViewComponent</code> in which our
													modules content lives (<code>ModuleViewComponent</code> is set as the component when defining routes for modules
													on app startup).</li>
												<li><code>dashboard/layouts</code>: It's a folder whose purpose is to clean our templates and give more meaning
													through naming elements that makes up our application.</li>
												<li><code>core</code>: Folder where singleton services are defined and used across all components.</li>
												<li><code>shared</code>: Folder where shared components are defined, the difference from <code>layouts</code> is
													that <code>shared</code> should contain small-scale components, such like buttons, modals, form elements, etc...
												</li>
												<li><code>shared-interfaces</code>: Global interfaces that don't necessarily represent a model/entity from the
													backend and are often used in different places.</li>
												<li><code>assets/lib</code>: Is the place where dependencies that couldn't be found using package managers end up.
												</li>
												<li><code>mock-data</code>: In cases when we're not getting any data from the backend just yet, we store files here
													that work as mock data to simulate responses, best case use is to define an async function that returns the mock
													data and in our application instead of fetching using http, we call the function to get the data asynchronously.
												</li>
												<li><code>utils</code>: Commonly used functions or logic that takes up a lot of lines of code that would otherwise
													mess with the readability of a component are stored in this folder. Do <b>not</b> insert component state or service
													logic in the functions defined here, only rudimentary functions are allowed.</li>
											</ul>
										
											<h2>Modules and routing</h2>
											<p>Modules refer to a section that make up our content, it is given to the client via a call to the backend and is
												tailored to each user. We use these modules to build our routing system, here's a basic route object that should be
												defined for each module that <b>possesses</b> content to display:</p>
												
<pre><code class="language-typescript">{
  path: module.route,
  component: ModuleViewComponent,
  title: `Admin ISP - ${module.name}`,
  data: { module }, // pass the module (holds info about how to retrieve module data and what children or parent modules they have)
  resolve: { // resolver used to fetch data before switching routes
    contentBlocks: moduleViewResolver
  }
}</code></pre>
											<p>These route objects are defined in the <code>ConfigurationService</code> service, the resolver
												<code>moduleViewResolver</code> we use is in charge of fetching the content for a module when there is a change in
												the route, if the fetching fails then the route won't activate. Think of the <code>moduleViewResolver</code> as a
												guard or middleware that accepts or rejects the change of route, but that also fetches the data to show within it.
											</p>
										
											<h3>DashboardModulesService</h3>
											<p>This service is responsible for storing the context of our application when traversing between modules within the
												dashboard, it stores data necessary across components that display the current module's info. It stores as well the
												entirety of the user's modules (array of modules). This service is vital for the next topic we'll be covering
												"<strong>Route based context</strong>".</p>
										
											<h3>Route based context</h3>
											<p>On dashboard startup and on route change within the dashboard (dashboard children routes), we subscribe to changes
												on the currently selected module <code>currentModule</code> in <code>DashboardModulesService</code>.
												<code>currentModule</code> should be updated inside resolver such as <code>moduleViewResolver</code> after a
												successful change of route and guards for routes that change the context.</p>
										
											<h3>Exception handling and redirection</h3>
											<p><strong>VERY IMPORTANT</strong>, There is a service under <code>core/services</code> called
												<code>error-handler.service.ts</code> that we'll be using a lot to handle different types of status codes that our
												backend can return. This service is what should be used whenever redirection is needed or any sort of error handling
												regarding data from the API.</p>
											<p>For example if a resolver doesn't manage to fetch the data it needs for the next route, we would use this service
												to redirect the user to a page that indicates the error that occurred.</p>
										
											<h3>Security</h3>
											<p>There is a service called <code>EncryptionService</code> which handles aspects of security throughout the
												application, one of those aspects is passing query parameters between routes in an encrypted manner. To do this the
												developer must be aware of the functions that handle these situations and use them accordingly. An example would
												look like this:</p>
<pre><code class="language-typescript">// encryption (sending side)
const module = this.encryptionService.encryptRouteParameter(this.module);
this.router.navigate(['/dashboard/modules'], { queryParams: { module } });

// decryption (receiving side)
ngOnInit() {
  const ciphertext = this.route.snapshot.queryParamMap.get('module')!;
  let decryptedData = this.encryptionService.decryptRouteParameter&lt;IModule&gt;(ciphertext);
  this.modules = decryptedData.childrenModules;
}</code></pre>
											<p>There is only a need for encryption for data that is sensitive or data that comes in the form of an Object or
												Array.</p>
										</article>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- README.md for a NestJS backend -->
				<div class="row">
					<div class="col-md-12">
						<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
							<div class="panel panel-custom">
								<div class="panel-heading" role="tab" id="exampleFour">
									<h4 class="panel-title">
										<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseExampleFour" aria-expanded="false" aria-controls="collapseOne">
											README.md for a NestJS backend
										</a>
									</h4>
								</div>
								<div id="collapseExampleFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="exampleFour">
									<div class="panel-body">
										<article class="markdown-body">
											<h1>AdminISP Backend</h1>
											
											<p>This is a backend for the AdminISP platform, built with NestJS (bootstrapped using Fastify).</p>
											
											<h2>Installation</h2>
											
											<p>This project was built with <code>Node v16.18.0 LTS</code>, so keep that in mind as you host this backend on a
												server. The following are steps to take in order to have a functioning application:</p>
											
											<ol>
												<li>Run <code>npm install</code> to install all dependencies.</li>
												<li>Remove the <code>.example</code> suffix from the <code>.env</code> files and add the proper values to each
													variable.
													<blockquote>If you don't want to delete <code>.env.development.example</code>, <code>.env.production.example</code>
														files and alter git's history, copy them and rename the copies without the <code>.example</code> suffix.
													</blockquote>
												</li>
												<li>Run <code>npm run start</code>, and you should have your service up and running. To serve your SPA, make sure to
													place it inside the <code>public/</code> folder.
													<blockquote>Your frontend should be responsible for building and placing the contents of your SPA inside the
														<code>public/</code> folder. In the case of a frontend using the angular CLI, we can do this by changing the value
														defined in the <code>"outputPath"</code> option inside the <code>angular.json</code> file.</blockquote>
												</li>
											</ol>
											
											<h2>Security</h2>
											
											<p>This backend possesses all sorts of security measures against dangers such as DoS (Denial of Service), DDoS
												(Distributed Denial of Service), XSS (Cross Site Scripting), open endpoints, lack of authentication, and other such
												cases. The following is a list of enabled tools (libraries and security aspects):</p>
											
											<ul>
												<li>helmet ‚úÖ</li>
												<li>CORS ‚úÖ</li>
												<li>Signed cookies ‚úÖ</li>
												<li>Throttler ‚úÖ</li>
												<li>Passport ‚úÖ
													<ul>
														<li>API Key Authorization Strategy ‚úÖ</li>
														<li>Local Authorization Strategy ‚úÖ</li>
													</ul>
												</li>
												<li>Request Body Validation ‚úÖ
													<ul>
														<li>Automatic pipe validation ‚úÖ</li>
														<li>class-validator ‚úÖ</li>
														<li>PickType(), OmitType() ‚úÖ</li>
														<li>Safe query-based resource lookup: ‚úÖ
															<blockquote>This is OK: <code>/forms?name=my%20form</code> ‚úîÔ∏è<br>
																This is not OK: <code>/forms?createdAt=2015-03-23-09.41.24.684842</code> ‚ùå</blockquote>
														</li>
													</ul>
												</li>
											</ul>
											
											<blockquote><strong>IMPORTANT:</strong> To establish communication with some endpoints, the client MUST add to their
												HTTP request headers the header <code>X-API-Key</code>, and the value should also be the same as the one defined in
												the <code>.env</code> files; otherwise, the request WILL be rejected with a 401 status code.</blockquote>
											
											<h3>Things to note</h3>
											
											<ul>
												<li>Signed cookies:</li>
												<ul>
													<li><code>fastify-cookie</code> is used for parsing cookies.</li>
													<li>Security is set in our <code>main.ts</code> file.</li>
													<li>Cookies are signed by default.</li>
													<li>The custom <code>@Cookies</code> decorator under the <code>src/decorators</code> folder is in charge of unsigning
														the cookies, so you don't have to do it inside your controller.</li>
												</ul>

												<li>Local Authorization Strategy:</li>
												<ul>
													<li>Refers to a Guard that handles user login attempts (checks if username and password match, that sort of thing).</li>
												</ul>
											</ul>
											
											<h2>Configuration</h2>
											
											<p>Details about how this backend is configured, such as global validation pipes, swagger setup, hot module reloading,
												configuration module/service, rate limiting, database connection, etc, should be found in <code>main.ts</code> and
												<code>app.module.ts</code>.</p>
											
											<h2>NPM Scripts</h2>
											
											<h3>Running the app</h3>
											
<pre><code class="language-bash"># development
$ npm run start

# watch mode (development)
$ npm run start:dev

# production mode
$ npm run start:prod</code></pre>
											
											<h3>Test</h3>
											
<pre><code class="language-bash"># unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov</code></pre>
											
											<h2>Development Policies</h2>
											
											<p>If you'd like to collaborate on this project, there are some <strong>policies</strong> that should be followed:</p>
											
											<ol>
												<li><strong>Naming convention for code:</strong> camelCase.</li>
												<li><strong>Documentation:</strong> Currently, this project maintains its documentation through the use of <a
														href="https://docs.nestjs.com/openapi/introduction">swagger</a> in NestJS. You can find documentation regarding
													API calls and their responses at the <code>/docs</code> route. If you're working on a new controller or expanding on
													an existing one, <strong>please</strong> follow the guide regarding <a
														href="https://docs.nestjs.com/openapi/introduction">swagger</a> to maintain a <strong>healthy codebase</strong>
													and <strong>collaborative environment</strong>.</li>
												<blockquote>At the moment <code>/docs</code> is only created when <code>process.env.NODE_ENV !== 'production'</code>,
													so basically, it only exists for developers that work on this API; it's not meant to be public.</blockquote>
												</li>
												<li><strong>Folder structure:</strong> Here is a breakdown of each subdirectory and what they should store.
													<ul>
														<li><strong>config:</strong> <a
																href="https://docs.nestjs.com/techniques/configuration#custom-configuration-files">Custom configuration
																files</a> used to define .env variables behavior and way of access.</li>
														<li><strong>dto:</strong> Classes that are used in request body validations, as NestJS <a
																href="https://docs.nestjs.com/techniques/validation#mapped-types">suggests</a>.</li>
														<li><strong>responses (NestJS non-standard):</strong> Classes that are used for <a
																href="https://docs.nestjs.com/openapi/operations#responses">documenting</a> and defining the type of response
															a route should return. In order for swagger to detect these files that possess a suffix of
															<code>.response.ts</code>, a new value was added to <code>"dtoFileNameSuffix"</code> inside the
															<code>nest-cli.json</code> file.
															<blockquote><strong>IMPORTANT:</strong> As a personal rule, considering this backend connects to a PostgreSQL
																database that uses a lot of tables and relationships, I've settled on creating <a
																	href="https://docs.nestjs.com/recipes/crud-generator#generating-a-new-resource">resources</a> that emulate
																the schemas in the database. For example, if I have a schema called <code>auth</code>, an <code>auth/</code>
																folder would be made under <code>src/</code> for operations regarding this schema; it would have a controller,
																service(s), entities, interfaces, dtos, etc... Overall, NestJS follows the same structure as an Angular
																project, so any good habits from there can be transferred over here.</blockquote>
														</li>
													</ul>
												</li>
												<li><strong>Routing:</strong> <a href="https://restfulapi.net/resource-naming/">This resource</a> explains it best.
													Nevertheless, I shall point out a few cases that are most likely to be implemented poorly.
													<ul>
														<li><strong>Use hyphens (-) to improve the readability of URIs:</strong> As the title says, a good route should
															use hyphens to separate words, no underscores, no uppercase letters. Here's a simple example:
															<blockquote><code>auth/modules/:id/contentBlocks</code> ‚ùå<br>
																<code>auth/modules/:id/content-blocks</code> ‚úÖ
															</blockquote>
														</li>
														<li><strong>Singleton and Collection Resources:</strong> Put, in a way that the previous resource already
															explained, basically if you have an entity <code>module</code>, we would create a route with the name of the
															entity in plural <code>modules</code> for operations that have something to do with it. This way, we can write
															easy-to-read routes that can handle different cases without confusing anybody (as well as establish a clear
															hierarchy when dealing with relationships). I'll present an example of the wrong and right way of doing this:
															<blockquote><code>auth/getModule/:id</code> ‚ùå<br>
																<code>auth/modules/:id</code> ‚úÖ<br>
																<code>auth/getAllModules</code> ‚ùå<br>
																<code>auth/modules</code> ‚úÖ<br>
																<code>auth/getModule/:id/contentBlocks</code> ‚ùå<br>
																<code>auth/modules/:id/content-blocks</code> ‚úÖ
															</blockquote>
														</li>
														<li><strong>Use query components to filter URI collection:</strong> The resource already makes a good point about
															it, so I will only provide a practical example of this if the need ever arises:
<pre><code class="language-typescript">// form-query.dto.ts
import { PartialType, OmitType } from "@nestjs/swagger";
import { Form } from "../entities/form.entity";

/**
* Class used for validation in lookups, for example:
* /forms?id=1&name=registro%20abonados -> HTTP 200
* /forms?name=consulta -> HTTP 200
* /forms?formGroups=2 -> HTTP 404
*/
export class FormQueryDto extends PartialType(OmitType(Form, ['formGroups'] as const)) {}

// dynamic-content.service.ts
public async findForm(fields: FormQueryDto): Promise&lt;Form | null&gt; {
  // for more details: https://orkhan.gitbook.io/typeorm/docs/repository-api
  return this.formsRepository.findOne({ where: fields });
}</code></pre>
															In this example, we simply use a Class <code>FormQueryDto</code> that describes the <code>Form</code> entity and
															does not include the <code>formGroups</code> property. In other words, we pass an object to
															<code>findForm</code> with optional keys that match the columns of this <code>Form</code> entity/table and use
															them to generate a where clause.
															<blockquote><strong>IMPORTANT:</strong> Implementation may vary depending on whether ORM is being used or just
																plain SQL queries.</blockquote>
														</li>
													</ul>
												</li>
												<li><strong>Testing:</strong> If you're working on a new module or adding some new functionality to the project,
													creating test files is by no means obligatory, <strong>however</strong>, if you're working on existing code which
													already has a test file with tests that are defined, it is your <strong>responsibility</strong> to maintain those
													tests if the objective of your work is to update or change the logic of what is being tested.</li>
											</ol>
											
											<h2>Additional Notes</h2>
											
											<p>When sending HTTP errors to the client, for a standard response among all routes, please use NestJS built-in <a
													href="https://docs.nestjs.com/exception-filters#built-in-http-exceptions">exceptions</a>. For example:</p>
											
<pre><code class="language-typescript">// server side
throw new BadRequestException('Bad request error', { cause: new Error(), description: 'Some error description' })

// what the client receives
{
  "message": "Bad request error",
  "error": "Some error description",
  "statusCode": 400,
}</code></pre>
											
											<p>Regarding the <code>cause</code> option property and the <code>Error</code> object, an error generated by the system
												should be of type <code>Error</code>, so the following should be acceptable:</p>
											
<pre><code class="language-typescript">// database.service.ts
async function find(id: number): Promise&lt;Item&gt; {
  let item = await this.db.execute('...', [id])
  return item
}

// item.controller.ts
@Get(':id')
example(@Param('id', ParseIntPipe) id: number) {
  try {
    let item = await this.databaseService.find(id)
    return item
  } catch (error) { // error should be of type Error
    throw new InternalServerErrorException('Internal server error', { cause: error, description: 'There was a problem finding an item with id=' + id })
  }
}</code></pre>
											
											<blockquote>Do take into account that NestJS already handles <strong>internal server errors</strong> when they occur due to a rejected promise or bad code. Therefore, unless you want to be more explicit with your error message, there is no need to wrap your code inside a <code>try-catch</code> in order to specify that an internal server error occurred, like the one in the example above.</blockquote>
										</article>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Assembly code for automatic car -->
				<div class="row">
					<div class="col-md-12">
						<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
							<div class="panel panel-custom">
								<div class="panel-heading" role="tab" id="exampleFive">
									<h4 class="panel-title">
										<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseExampleFive" aria-expanded="false" aria-controls="collapseOne">
											Assembly code for automatic car
										</a>
									</h4>
								</div>
								<div id="collapseExampleFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="exampleFive">
									<div class="panel-body">
<pre><code class="language-mipsasm">list P = 16F877A
include &lt;P16F877A.inc&gt;
;**************************************** README **************************************************************
;* Lower side sensors:                                                                                        *
;* -RB7: front                                                                                                *
;* -RB6: right                                                                                                *
;* -RB5: back                                                                                                 *
;* -RB4: left                                                                                                 *
;*                                                                                                            *
;* Ultrasound sensor:                                                                                         *
;* -RB0: echo pin, este pin se pone en 0 cuando se recibe el eco del sensor                                   *
;* -RB1: Trig pin, este pin se usa para generar el pulso de 10 micro segundos para mandar una onda            *
;*                                                                                                            *
;* Mode port:                                                                                                 *
;* - RD0 (1 = CompMode, 0 = TrackMode)                                                                        *
;*                                                                                                            *
;* Interrupciones usadas (Track Mode):                                                                        *
;* - RB port change                                                                                           *
;*                                                                                                            *
;* Interrupciones usadas (Comp Mode):                                                                         *
;* - TMR1                                                                                                     *
;* - RB port change                                                                                           *
;*                                                                                                            *
;* Notas:                                                                                                     *
;* - pendiente de cuando manipular el registro timer para evitar comportamientos raros (en interrupciones)    *
;* - recuerda poner algo debajo de ChckRB5 en steppingLine, que comportamiento para los sensores laterales    *
;* seria bueno?                                                                                               *
;* - steppingLine es un trabajo en progreso, el comportamiento puede ser discutido                            *
;* - las funciones para girar todavia no estan disenadas para ser usadas en retroceso                         *
;* - en TrackInt se asume que los sensores laterales estan fuera de la linea                                  *
;**************************************************************************************************************

;**************************************** Variables *************************************************************

W_AUX EQU 20h
speed EQU 21h ; variable que guarda la velocidad actual del carro
turn_speed EQU 22h ; variable que posee valores menores a speed, se obtiene de la division de speed
aux EQU 23h ; variable auxiliar para realizar operaciones matematicas
cociente EQU 24h ; variable auxiliar para obtener el cociente en una division

;************* Variables modo COMP *****************************
time EQU 25h
isReverse EQU 26h ; booleano que indica si el carro va en reverso, bit 0 = 1 significa true
isEscaping EQU 27h ; booleano que indica si el carro esta escapando de la linea negra
toggle EQU 28h
isRotating EQU 29h
ms500_to_sweep EQU 2Ah
sweeps EQU 2Bh
ms500_to_rotate EQU 2Ch
previous_state0 EQU 2Dh
previous_state1 EQU 2Eh
current_state EQU 2Fh
;***************************************************************

;****************************************************************************************************************

org 0h
    btfss PORTD, 0 ; asumiendo que RD0 es el que me dice en que modo esta
    goto TrackMode
    goto CompMode
;********************************** Interrupcion ****************************************************************		
org 4h
    movwf W_AUX ; guardo el valor previo de W para no generar comportamientos raros
    btfss PORTD, 0
    goto TrackM ; Track Mode Interruption
    btfss INTCON, 0 ; reviso bandera de RB&lt;7:4&gt;
    goto NotRB
    call RBChangeInt
    movf W_AUX, 0 ; devuelvo el valor de W
    retfie
NotRB	call TMR1Int
    movf W_AUX, 0 ; devuelvo el valor de W
    retfie

TrackM	call TrackInt
    movf W_AUX, 0 ; devuelvo el valor de W
    retfie	
;****************************************************************************************************************
org 16h
TrackMode
;************************************** Configuracion Track Mode ************************************************
    movf PORTB, 0 ; leo PORTB para poder bajar la bandera de RB port change por si se encuentra en 1 
    bcf INTCON, 0 ; bajo la bandera RBIF
    
    ;************* Configuracion PWM 1 y 2 *************************
    ; PWMduty cycle = (CCPR1L : CCP1CON(5,4))*Tosc*(Prescaler de TMR2)
    ; En nuestro caso: duty cycle de 100% es decir, CCPR1L = 255, hallo el periodo -> 1*PWMperiodo = 1020*(1/4*10^-6)*16 = 4.08*10^-3, 1020 es 11111111:00 => CCPR1L:CCP1CON(5,4) con CCPR1L = ADRESH
    clrf CCPR1L ; el duty sera de 0 al inicio
    clrf CCPR2L
    bsf STATUS, 5
    movlw d'254' ; PWMperiodo = (PR2+1)*4*Tosc*(Prescaler de TMR2) => PR2 = (4.08*10^-3)/(10^-6 * 16) = 254
    movwf PR2 ; el valor calculado de X se carga para el periodo de la onda, el valor de PR2, no se debe exceder de 255 o ser negativo en el calculo, si se excede se debe usar otro prescaler
    
    ;************* Configuracion pines ********
    bcf TRISC, 2 ; configuro pin ccp1 como salida
    bcf TRISC, 1 ; configuro pin ccp2 como salida
    ; RB&lt;7:4&gt; son los sensores
    ;******************************************
    
    ;************* Configuracion INT **********
    bsf INTCON, 7 ; global
    bsf INTCON, 3 ; RB Port Change Interrupt Enable bit RB&lt;7:4&gt;
    ;******************************************    
    
    bcf STATUS, 5
    bsf T2CON, 1 ; configuro el prescaler 16 de TMR2, 00 = 1, 01 = 4, 1X = 16
    bsf T2CON, 2 ; prendo el TMR2
    bsf CCP1CON, 3 ; configuro el modulo CCP1 como PWM (11xx de bits 3-0)
    bsf CCP1CON, 2
    bsf CCP2CON, 3 ; configuro el modulo CCP2 como PWM (11xx de bits 3-0)
    bsf CCP2CON, 2
    ;***************************************************************	
;****************************************************************************************************************

;****************************** Inicializacion de variables ******************************************************
    clrf speed
    clrf turn_speed
    clrf cociente
;****************************************************************************************************************

;**************************************** Main Tracking Mode ****************************************************
    movlw d'128' ; MED_SPEED
    call setSpeed ; speed = MED_SPEED
    movlw d'64' ; speed/2
    movwf turn_speed
    call stopTurning ; el carro va derecho al inicio
TMain 	goto TMain
;****************************************************************************************************************

;************************************** Funciones INT Track Mode ************************************************
TrackInt
    btfsc PORTB, 6 ; left && right
    btfss PORTB, 4
    goto ChckRB6
    call stopTurning
    goto TrckEnd
ChckRB6	btfss PORTB, 6 ; reviso si el sensor de la derecha detecto la linea negra, si la toco entonces el carro tiene que girar a la derecha
    goto ChckRB4
    call turnRight
    goto TrckEnd
ChckRB4 btfss PORTB, 4
    goto AllOff ; left || right = false
    call turnLeft
    goto TrckEnd
AllOff	call stopTurning		
TrckEnd	bcf INTCON, 0 ; bajo la bandera
    return
;****************************************************************************************************************

;***********************************************************************************************************************************************************
;***********************************************************************************************************************************************************
;***********************************************************************************************************************************************************

CompMode
;************************************** Configuracion Comp Mode *************************************************
    movf PORTB, 0 ; leo PORTB para poder bajar la bandera de RB port change por si se encuentra en 1 
    bcf INTCON, 0 ; bajo la bandera RBIF
    
    ;************* Configuracion PWM 1 y 2 *************************
    ; PWMduty cycle = (CCPR1L : CCP1CON(5,4))*Tosc*(Prescaler de TMR2)
    ; En nuestro caso: duty cycle de 100% es decir, CCPR1L = 255, hallo el periodo -> 1*PWMperiodo = 1020*(1/4*10^-6)*16 = 4.08*10^-3, 1020 es 11111111:00 => CCPR1L:CCP1CON(5,4) con CCPR1L = ADRESH
    clrf CCPR1L ; el duty sera de 0 al inicio
    clrf CCPR2L
    bsf STATUS, 5
    movlw d'254' ; PWMperiodo = (PR2+1)*4*Tosc*(Prescaler de TMR2) => PR2 = (4.08*10^-3)/(10^-6 * 16) = 254
    movwf PR2 ; el valor calculado de X se carga para el periodo de la onda, el valor de PR2, no se debe exceder de 255 o ser negativo en el calculo, si se excede se debe usar otro prescaler
    
    ;************* Configuracion pines ********
    bcf TRISC, 2 ; configuro pin ccp1 como salida
    bcf TRISC, 1 ; configuro pin ccp2 como salida
    bcf TRISB, 1 ; RB1 es el Trig del sensor de ultrasonido
    ; RB&lt;7:4&gt; son los sensores
    ;******************************************
    
    ;************* Configuracion INT **********
    bsf INTCON, 7 ; global
    bsf INTCON, 3 ; RB Port Change Interrupt Enable bit RB&lt;7:4&gt;
    bsf INTCON, 6 ; int perifericos
    bsf PIE1, 0 ; habilito la interrupcion del overflow del TMR1
    ;******************************************    		
    
    ;************* Configuracion TMR0 ******************************
    bcf OPTION_REG, 0 ; prescaler 128 para cubrir la distancia maxima de 4 metros (TMR0 = 182) y evitar overflows
    bcf OPTION_REG, 5 ; el tmr0 es temporizador
    bcf OPTION_REG, 3 ; prescaler asignado a tmr0
    ;***************************************************************
    
    bcf STATUS, 5
    
    ;************* Configuracion TMR1 *********
    ; configuro aqui el prescaler de T1CON (bits 5-4 => 11 = 1:8, 10 = 1:4, 01 = 1:2, 00 = 1:1)
    bsf T1CON, 5
    bsf T1CON, 4
    bsf T1CON, 3 ; habilito el oscilador
    clrf TMR1H
    clrf TMR1L
    ; ** recuerda prender el TMR1 en algun lado "bsf T1CON, 0" **
    ;******************************************
    
    bsf T2CON, 1 ; configuro el prescaler 16 de TMR2, 00 = 1, 01 = 4, 1X = 16
    bsf T2CON, 2 ; prendo el TMR2
    bsf CCP1CON, 3 ; configuro el modulo CCP1 como PWM (11xx de bits 3-0)
    bsf CCP1CON, 2
    bsf CCP2CON, 3 ; configuro el modulo CCP2 como PWM (11xx de bits 3-0)
    bsf CCP2CON, 2
    ;***************************************************************
    
    bcf PORTB, 1 ; lo pongo en 0 por si estaba en 1 antes (para el sensor)
;****************************************************************************************************************

;****************************** Inicializacion de variables *****************************************************
    clrf speed
    clrf turn_speed
    clrf cociente
    clrf isReverse
    clrf isEscaping
    clrf time
    clrf toggle
    clrf isRotating
    movlw d'5' ; al comienzo el carro va a comenzar en el medio del barrido
    movwf ms500_to_sweep
    clrf sweeps
    clrf ms500_to_rotate
    clrf previous_state0
    clrf previous_state1
;****************************************************************************************************************

;**************************************** Main Comp Mode ********************************************************
    bsf T1CON, 0 ; prendo el tmr1
    call medSeg  ; los 500ms iniciales al barrir
CMain 	btfsc isEscaping, 0 ; si el carro esta escapando, no hacer nada
    goto CMain
    ;************ ultra sound block ****************
    call assessProximity ; si activateUltraSound retorna C = 0, si esta en proximidad
    btfsc STATUS, 0 ; verifico CFLAG de la operacion hecha en assessProximity (C = 0 significa que si esta en proximidad)
    goto NtClose ; not close
    bcf isRotating, 0 ; el carro detecto algo, borra todo sobre el movimiento usual
    clrf ms500_to_rotate
    clrf sweeps
    movlw d'5'
    movwf ms500_to_sweep ; el carro hara medio barrido como el inicio
    btfsc isEscaping, 0 ; en caso de que ocurra una interrupcion despues de assessProximity y no despues del inicio de CMain
    goto CMain
    movlw d'255'
    call setSpeed
    call stopTurning
    call medSeg ; esto va a interrumpir solo cuando assessProximity ha fallado 20 veces seguidas (25ms * 20 = 500ms)
    goto CMain
    ;***********************************************
NtClose	btfsc isRotating, 0 ; si el carro esta rotando, dejar volver a medir la distancia al inicio del CMain
    goto CMain
    ; aqui ocurre el barrido
    movlw d'64' ; SEEKING_SPEED
    call setSpeed
    movlw d'32' ; SEEKING_SPEED/2
    movwf turn_speed
    btfss toggle, 0 ; toggle alterna cada 5 segundos, haciendo que el carro se mueva como una serpiente
    goto Lft
    call turnRight
    goto CMain
Lft		call turnLeft
		goto CMain
;****************************************************************************************************************

;************************************** Funciones INT Comp Mode *************************************************
RBChangeInt ; tomo las medidas necesarias para redirigir el auto
		bsf isEscaping, 0
		clrf current_state ; cero inicial del estado actual
		btfsc PORTB, 4
		goto StpLine
		btfsc PORTB, 6
		goto StpLine
		btfsc PORTB, 5
		goto StpLine
		call checkScenario ; verifica un escenario espesifico, Z = 1 significa que si se dio el escenario
		btfsc STATUS, 2 ; verifico el valor de Z, si es 0 entonces el escenario no se cumplio
		call stopTurning ; el escenario resulto ser cierto
		call saveState ; en este bloque current_state se queda en 0
		bsf T1CON, 0 ; todos los sensores estan en 0, por lo tanto esta escapando
		call medSeg
		clrf time ; limpio el timer para indicar el comienzo de la salida de la linea negra
		goto RBEnd
StpLine	btfsc PORTB, 4 ; le asigno los bits que estan encendidos a current_state
		bsf current_state, 4
		btfsc PORTB, 5
		bsf current_state, 5
		btfsc PORTB, 6
		bsf current_state, 6
		call saveState ; guardo el nuevo estado		
		call fullyDeactivateTMR1 ; limpio todo los procesos que involucren el tmr1 fuera de la interrupcion RB
		call stopTurning ; detengo lo que estaba haciendo antes
		call steppingLine ; aqui verifico los bits de RB para tomar las medidas correspondientes
RBEnd	bcf INTCON, 0 ; apago la bandera al final cuando PORTB vuelve a su estado original (00000000) asumiendo que los sensores al detectar la linea negra se pongan en 1
		return

TMR1Int ; verifico cuantos segundos han pasado (todavia no se sabe cuantos segundos seran, por ahora 4s)
		bcf PIR1, 0 ; apago la bandera del TMR1 overflow
		btfss isEscaping, 0
		goto IsRotng ; is rotating?
		incf time, 1 ; aqui el carro esta escapando
		btfsc time, 3 ; si time es 8, han pasado 4 segundos
		goto Safe ; time = 8
		call medSeg ; si no es 8 entonces espero el otro medio segundo
		return
Safe	; aqui el carro hace lo suyo, despues de exitosamente salirse de la linea negra hace 4 segundos
		clrf time ; limpio time
		bcf isReverse, 0 ; por si el carro iba en reversa
		bcf isEscaping, 0 ; es el final del escape
		call medSeg ; empieza el conteo del modo de barrido
		return			
isRotng	btfss isRotating, 0
		goto NtRot ; not rotating
		incf ms500_to_rotate, 1
		movlw d'24'
		subwf ms500_to_rotate, 0
		btfss STATUS, 2 ; ms500_to_rotate == 24 (12 segundos)
		goto DntStop ; dont stop rotating, keep counting
		clrf ms500_to_rotate
		bcf isRotating, 0 ; ya el carro no esta rotando
		call stopTurning
		movlw d'5' ; el carro va a entrar en medio barrido como el comienzo
		movwf ms500_to_sweep
DntStop	call medSeg ; es el inicio del barrido o seguir contando la rotacion
		return
NtRot	incf ms500_to_sweep, 1 ; si no esta rotando ni esta escapando, el carro deberia estar barriendo
		movlw d'10' ; SWEEP_TIME
		subwf ms500_to_sweep, 0
		btfss STATUS, 2 ; ms500_to_sweep == 10
		goto KpSwpng ; not yet, dont toggle, keep sweeping
		movlw d'1'
		xorwf toggle, 1 ; toggle = !toggle, 1 xor 1 = 0 ; 1 xor 0 = 1
		clrf ms500_to_sweep
		incf sweeps, 1
		btfss sweeps, 2 ; si sweeps = 4, es decir si el carro barrio 4 veces
		goto KpSwpng ; si sweeps no es 4, simplemente sigo en el medio del barrido
		clrf sweeps ; si sweeps = 4 -> sweeps = 0 y el resto de lo que sigue
		bsf isRotating, 0
		call rotate
KpSwpng	call medSeg ; o sigue barriendo o empieza el conteo del inicio de la rotacion
		return
;****************************************************************************************************************

;***********************************************************************************************************************************************************
;***********************************************************************************************************************************************************
;***********************************************************************************************************************************************************

;************************************** Funciones Generales *****************************************************
medSeg	; le doy el valor necesario a TMR1 para que interrumpa en medio segundo
		movlw b'11011100'
		movwf TMR1L
		movlw b'00001011'
		movwf TMR1H
		return
		
setSpeed ; accepts a value from w
		movwf speed
		return
		
turnRight ; disminuir la velocidad de las ruedas en la derecha
		movf speed, 0
		movwf CCPR1L
		movf turn_speed, 0
		movwf CCPR2L
		return

turnLeft ; disminuir la velocidad de las ruedas en la izquierda
		movf speed, 0
		movwf CCPR2L
		movf turn_speed, 0
		movwf CCPR1L
		return
		
stopTurning ; ambos lados tienen la misma velocidad
		movf speed, 0
		movwf CCPR1L
		movwf CCPR2L
		return

assessProximity ; funcion que inicia el sensor y retorna una respuesta (valor de Carry)
		bsf PORTB, 1 ; TRIG = 1
		call delay10us
		bcf PORTB, 1
WtEcho	btfss PORTB, 0
		goto WtEcho ; wait echo
		clrf TMR0 ; el tmr0 va a empezar a contar desde 0
NotYet	btfsc PORTB, 0 ; espero a que el pin de eco se baje, que es cuando recibe la respuesta
		goto NotYet
		call TMR0_OFF
		movlw d'6' ; distancia cm = (X*Prescaler/2*29,1) => 10 cm = (X*128/2*29,1) => X = 4,54 = 5 => distancia cm = (5*128/2*29,1) = 10,99 = 11
		subwf TMR0, 0 ; si TMR0 = 5 -> 5 - 6 = -1 -> C = 0, si esta en proximidad (11 cm)
		return

delay10us
		nop ; aqui hay 6 nops, el call y return cuentan como 4 micro segundos
		nop
		nop
		nop
		nop
		nop
		return

fullyDeactivateTMR1 ; nombre bastante explicatorio, esto se llama cuando ocurren tanto cosas inesperadas como momentos de seguridad al salirse de la linea negra
		bcf T1CON, 0
		clrf TMR1H
		clrf TMR1L
		clrf time
		clrf sweeps
		clrf ms500_to_rotate
		clrf ms500_to_sweep
		bcf isRotating, 0
		return		

saveState ; funcion que guarda los nuevos estados
		movf previous_state1, 0
		movwf previous_state0 ; previous_state0 = previous_state1
		movf current_state, 0
		movwf previous_state1 ; previous_state1 = current_state
		return
		
checkScenario
		movlw b'010100000' ; sensores laterales encendidos
		subwf previous_state0, 0
		btfss STATUS, 2
		return ; retornara Z = 0
		btfsc previous_state1, 4 ; sensor de la izquierda
		return ; retornara Z = 1
		btfsc previous_state1, 6 ; sensor de la derecha
		return ; retornara Z = 1
		bcf STATUS, 2
		return ; retornara Z = 0
		

steppingLine ; funcion que se llama cuando el carro toca la linea en modo competitivo
		btfsc PORTB, 4 ; LEFT_SENSOR && RIGHT_SENSOR
		btfss PORTB, 6
		goto Nxt1 ; siguiente condicion
		; sensor izquierdo y derecho estan activados
		bsf isReverse, 0
		movlw d'255' ; FULL_SPEED
		call setSpeed ; speed = FULL_SPEED
		call stopTurning
		return
Nxt1	btfsc PORTB, 4 ; LEFT_SENSOR && BACK_SENSOR
		btfss PORTB, 5
		goto Nxt2
		; sensor izquierdo y trasero estan activados
		bcf isReverse, 0
		movlw d'255' ; FULL_SPEED
		call setSpeed ; speed = FULL_SPEED
		movlw d'128' ; FULL_SPEED/2
		movwf turn_speed
		call turnRight
		return
Nxt2	btfsc PORTB, 6 ; RIGHT_SENSOR && BACK_SENSOR
		btfss PORTB, 5
		goto Nxt3
		bcf isReverse, 0
		movlw d'255' ; FULL_SPEED
		call setSpeed ; speed = FULL_SPEED
		movlw d'128' ; FULL_SPEED/2
		movwf turn_speed
		call turnLeft
		return
Nxt3	btfss PORTB, 4 ; LEFT_SENSOR
		goto Nxt4
		bsf isReverse, 0
		movlw d'255' ; FULL_SPEED
		call setSpeed ; speed = FULL_SPEED
		movlw d'128' ; FULL_SPEED/2
		movwf turn_speed
		call turnRight
		return
Nxt4	btfss PORTB, 6 ; RIGHT_SENSOR
		goto Nxt5
		bsf isReverse, 0
		movlw d'255' ; FULL_SPEED
		call setSpeed ; speed = FULL_SPEED
		movlw d'128' ; FULL_SPEED/2
		movwf turn_speed
		call turnLeft
		return
Nxt5	btfss PORTB, 5 ; BACK_SENSOR
		return ; guess I'll die (the port change would be the only sensor that left the black line, or something like that, think of it like a null check)
		bcf isReverse, 0
		movlw d'255' ; FULL_SPEED
		call setSpeed ; speed = FULL_SPEED
		call stopTurning
		return
		
rotate ; funcion que hace rotar al carro
		nop
		return
;****************************************************************************************************************

end
</code></pre>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- end snippets -->

		<!-- start portfolio -->
		<section id="portfolio" class="custom-scrollbar">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<h2 class="bounce">PORTFOLIO</h2>
					</div>
					<div class="col-md-4 col-xs-6 animate invisible" data-animation="rotateInDownLeft" data-animation-delay="0.3s">
						<div class="portfolio-thumb">
							<img src="images/portfolio-img1.jpg" class="img-responsive" alt="portfolio img">
							<div class="portfolio-overlay">
								<h4>Web Design</h4>
								<h5>Author: Cindy</h5>
							</div>
						</div>
					</div>
					<div class="col-md-4 col-xs-6 animate invisible" data-animation="rotateInDownLeft" data-animation-delay="0.6s">
						<div class="portfolio-thumb">
							<img src="images/portfolio-img2.jpg" class="img-responsive" alt="portfolio img">
							<div class="portfolio-overlay">
								<h4>Web App</h4>
								<h5>Author: Linda</h5>
							</div>
						</div>
					</div>
					<div class="col-md-4 col-xs-6 animate invisible" data-animation="rotateInDownLeft" data-animation-delay="0.9s">
						<div class="portfolio-thumb">
							<img src="images/portfolio-img3.jpg" class="img-responsive" alt="portfolio img">
							<div class="portfolio-overlay">
								<h4>Mobile App</h4>
								<h5>Author: Kate</h5>
							</div>
						</div>
					</div>
					<div class="col-md-6 col-xs-6 animate invisible" data-animation="rotateInDownLeft" data-animation-delay="1.2s">
						<div class="portfolio-thumb">
							<img src="images/portfolio-img4.jpg" class="img-responsive" alt="portfolio img">
							<div class="portfolio-overlay">
								<h4>Old Artwork</h4>
								<h5>Author: Catherine</h5>
							</div>
						</div>
					</div>
					<div class="col-md-6 col-xs-6 animate invisible" data-animation="rotateInDownLeft" data-animation-delay="1.5s">
						<div class="portfolio-thumb">
							<img src="images/portfolio-img5.jpg" class="img-responsive" alt="portfolio img">
							<div class="portfolio-overlay">
								<h4>New Animation</h4>
								<h5>Author: Kathy</h5>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- start footer -->
			<footer>
				<div class="container">
					<div class="row">
						<div class="col-md-12 fadeIn" data-animation-delay="0.9s">
							<p>Copyright &copy; 2023 AndresRCA Personal Profile
							<hr>
							<ul class="social-icon">
								<li><a href="https://github.com/AndresRCA" class="fa fa-github"></a></li>
								<li><a href="https://www.linkedin.com/in/andres-castillo-439bb3124" class="fa fa-linkedin"></a></li>
							</ul>
						</div>
					</div>
				</div>
			</footer>
			<!-- end footer -->
		</section>
		<!-- end portfolio -->

	</div>

	<!-- jQuery -->
	<script src="js/jquery.js"></script>
	<!-- bootstrap v3.3.4 -->
	<script src="js/bootstrap.min.js"></script>
	<!-- docSlider -->
	<script src="js/docSlider.min.js"></script>
	<!-- text rotater -->
	<script src="js/jquery.simple-text-rotator.js"></script>
	<!-- custom -->
	<script src="js/main.js"></script>
</body>

</html>